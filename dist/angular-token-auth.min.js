!function(a){"use strict";var b=a.module("angular-token-auth.config",["angular-token-auth.constants","project_settings"]);b.config(["$httpProvider",function(a){a.interceptors.push("authInterceptor")}]),b.run(["$rootScope","$log","authRouteChangeStartFactory","authModuleSettings",function(a,b,c,d){d.ALLOWED_HOSTS.length||b.error("ALLOWED_HOSTS is empty. Set ALLOWED_HOSTS to a list of hosts that the auth token can be sent to."),a.$on("$routeChangeStart",c)}])}(window.angular),function(a){"use strict";var b=a.module("angular-token-auth.constants",[]);b.constant("TOKEN_AUTH",{ENDPOINT:"/auth/",LOGIN:"/login/",LOGOUT:"/logout/",LOGIN_REDIRECT_URL:"/",LOGOUT_REDIRECT_URL:"/logout/",AUTH_HEADER_PREFIX:"Token",ALLOWED_HOSTS:[],COOKIE_PATH:null})}(window.angular),function(a){"use strict";var b=a.module("angular-token-auth.auth-login",[]);b.controller("LoginCtrl",[a.noop])}(window.angular),function(a){"use strict";var b=a.module("angular-token-auth.auth-logout",["angular-token-auth.auth-actions"]);b.controller("LogoutCtrl",["authActionsFactory",function(a){a.logout()}])}(window.angular),function(a){"use strict";var b=a.module("angular-token-auth.auth-login-form",["angular-token-auth.auth-login-form-directive-factory"]);b.directive("loginForm",["authLoginFormDirectiveFactory",function(a){return a}])}(window.angular),function(a){"use strict";a.module("angular-token-auth",["angular-token-auth.auth-login","angular-token-auth.auth-logout","angular-token-auth.auth-login-form","angular-token-auth.auth-actions","angular-token-auth.auth","angular-token-auth.auth-interceptor","angular-token-auth.auth-login-form-directive-factory","angular-token-auth.auth-login-form","angular-token-auth.auth-module-settings","angular-token-auth.auth-route-change-start","angular-token-auth.auth-storage","angular-token-auth.routes","angular-token-auth.config","angular-token-auth.constants","angular-token-auth.auth-login-form-factory","angular-token-auth-login-redirect","angular-token-auth-login-redirect-token-auth-clear","angular-token-auth-login-redirect-token-auth-settings"])}(window.angular),function(a){"use strict";var b=a.module("angular-token-auth.auth-actions",["project_settings","angular-token-auth.auth","angular-token-auth.auth-module-settings"]);b.factory("authActionsFactory",["$q","$http","$location","PROJECT_SETTINGS","authModuleSettings","authFactory",function(a,b,c,d,e,f){return{login:function(c,g){var h=a.defer();return b.post(d.API_ROOT+e.ENDPOINT,{username:c,password:g}).success(function(a){f.setAuth(a),h.resolve(a)}).error(h.reject),h.promise},logout:function(){var g=a.defer();return b["delete"](d.API_ROOT+e.ENDPOINT).success(g.resolve).error(g.reject)["finally"](function(){f.clearAuth(),c.url(e.LOGOUT_REDIRECT_URL)}),g.promise}}}])}(window.angular),function(a){"use strict";var b=a.module("angular-token-auth.auth",["angular-token-auth.auth-storage"]);b.factory("authFactory",["$rootScope","authStorageFactory",function(b,c){return{getAuth:function(){var b=c.get("auth");return a.isObject(b)?b:null},getToken:function(){var b=this.getAuth();return null!==b&&a.isDefined(b.token)?b.token:null},setAuth:function(a){c.set("auth",a),b.$broadcast("tokenAuth:set")},clearAuth:function(){c.clear("auth"),b.$broadcast("tokenAuth:clear")}}}])}(window.angular),function(a){"use strict";var b=a.module("angular-token-auth.auth-interceptor",["angular-token-auth.auth","angular-token-auth.auth-module-settings"]);b.factory("authInterceptor",["$rootScope","$q","$location","authFactory","authModuleSettings",function(a,b,c,d,e){return{request:function(a){var b=e.ALLOWED_HOSTS,f=document.createElement("a");f.href=a.url;var g=f.host,h=f.hostname;if(g||h||(g=h=c.host()),b.indexOf(g)>-1||b.indexOf(h)>-1){a.headers=a.headers||{};var i=d.getToken();i&&(a.headers.Authorization=e.AUTH_HEADER_PREFIX+" "+i)}return a},responseError:function(a){return 401===a.status&&d.clearAuth(),b.reject(a)}}}])}(window.angular),function(a){"use strict";var b=a.module("angular-token-auth.auth-login-form-directive-factory",["angular-token-auth.auth-login-form"]);b.factory("authLoginFormDirectiveFactory",["AuthLoginFormFactory",function(a){return{restrict:"A",scope:!0,templateUrl:"templates/auth/login_form.html",link:function(b,c,d){new a(b,c,d)}}}])}(window.angular),function(a){"use strict";var b=a.module("angular-token-auth.auth-login-form-factory",["ngRoute"]);b.factory("AuthLoginFormFactory",["authActionsFactory","$location","authFactory","authModuleSettings",function(b,c,d,e){d.getToken()&&c.url(e.LOGIN_REDIRECT_URL);var f=function(a){this.scope=a,this.init()};return f.prototype={init:function(){this.scope.status={},this.scope.fields={username:{required:!0},password:{required:!0}},this.scope.login=a.bind(this,this.loginClick)},loginSuccess:function(){c.url(c.search().next||e.LOGIN_REDIRECT_URL)},loginFailed:function(a){this.scope.errors=a,a.non_field_errors&&(this.scope.fields.errors=[{msg:a.non_field_errors[0]}]),this.scope.fields.username.errors=a.username?a.username[0]:"",this.scope.fields.password.errors=a.password?a.password[0]:""},loginFinally:function(){this.scope.status.authenticating=!1},loginClick:function(){delete this.scope.errors,this.scope.fields.errors="",this.scope.fields.username.errors="",this.scope.fields.password.errors="",this.scope.status.authenticating=!0,b.login(this.scope.fields.username.value,this.scope.fields.password.value).then(a.bind(this,this.loginSuccess),a.bind(this,this.loginFailed))["finally"](a.bind(this,this.loginFinally))}},f}])}(window.angular),function(a){"use strict";var b=a.module("angular-token-auth-login-redirect",["ngRoute","angular-token-auth-login-redirect-token-auth-clear","angular-token-auth.auth-route-change-start"]);b.factory("authLoginRedirect.run",["$rootScope","authRouteChangeStartFactory","authLoginRedirect.onTokenAuthClear",function(a,b,c){return function(){a.$on("$routeChangeStart",b),a.$on("tokenAuth:clear",c.handler)}}])}(window.angular),function(a){"use strict";var b=a.module("angular-token-auth-login-redirect-token-auth-clear",["ngRoute","angular-token-auth-login-redirect-token-auth-settings"]);b.service("authLoginRedirect.onTokenAuthClear",["$route","$location","authLoginRedirect.getTokenAuthSettings",function(b,c,d){this.handler=a.bind(this,function(){this.routeIsAnonymous(b.current.$$route)||this.redirect()}),this.routeIsAnonymous=function(a){var b=!0;return a&&a.anonymous===!1&&(b=!1),b},this.redirect=function(){var a=d(),b=c.path();c.url(a.LOGOUT_REDIRECT_URL).search("next",b)}}])}(window.angular),function(a){"use strict";var b=a.module("angular-token-auth-login-redirect-token-auth-settings",["project_settings","angular-token-auth.constants"]);b.factory("authLoginRedirect.getTokenAuthSettings",["PROJECT_SETTINGS","TOKEN_AUTH",function(b,c){return function(d){var e=a.extend({},c,b.TOKEN_AUTH);return d?e[d]:e}}])}(window.angular),function(a){"use strict";var b=a.module("angular-token-auth.auth-module-settings",["project_settings","angular-token-auth.constants"]);b.factory("authModuleSettings",["TOKEN_AUTH","PROJECT_SETTINGS",function(b,c){return a.extend({},b,c.TOKEN_AUTH)}])}(window.angular),function(a){"use strict";var b=a.module("angular-token-auth.auth-route-change-start",["angular-token-auth.auth","angular-token-auth.auth-module-settings","angular-token-auth.constants"]);b.factory("authRouteChangeStartFactory",["$location","authFactory","authModuleSettings",function(b,c,d){return function(e,f){var g=f.$$route,h=!0;a.isDefined(g)&&g.anonymous===!1&&(h=!1);var i=!1;a.isDefined(g)&&g.anonymousOnly===!0&&(i=!0),c.getToken()?i&&b.url(d.LOGIN_REDIRECT_URL):h||(b.url(d.LOGIN+"?next="+b.path()),b.replace())}}])}(window.angular),function(a){"use strict";var b=a.module("angular-token-auth.auth-storage",[]);b.factory("authStorageFactory",["$window","$browser","authModuleSettings",function(b,c,d){var e=d.COOKIE_PATH?d.COOKIE_PATH:c.baseHref(),f={noSupport:{set:a.noop,get:a.noop,clear:a.noop},cookie:{test:function(){b.document.cookie="testcookie=test";var a=b.document.cookie.indexOf("testcookie")!==-1;return b.document.cookie="testcookie=test;expires=Thu, 01-Jan-1970 00:00:01 GMT",a},set:function(c,d){var f=encodeURIComponent(a.toJson(d));b.document.cookie=encodeURIComponent(c)+"="+f+(e?";path="+e:"")},get:function(c){for(var d=b.document.cookie.split("; "),e=0,f=d.length;e<f;e++){var g=d[e],h=g.indexOf("=");if(h>0){var i=decodeURIComponent(g.substring(0,h));if(i===c){var j=decodeURIComponent(g.substring(h+1));return j?a.fromJson(j):j}}}},clear:function(a){b.document.cookie=encodeURIComponent(a)+"=;expires=Thu, 01 Jan 1970 00:00:00 GMT"}},localStorage:{test:function(){return a.isDefined(b.localStorage)},set:function(c,d){b.localStorage.setItem(c,a.toJson(d))},get:function(c){return a.fromJson(b.localStorage.getItem(c))},clear:function(a){b.localStorage.removeItem(a)}}},g=f[d.STORAGE_METHOD];return g&&g.test()?g:f.cookie.test()===!0?f.cookie:f.localStorage.test()?f.localStorage:f.noSupport}])}(window.angular),function(a){"use strict";var b=a.module("angular-token-auth.routes",["angular-token-auth.constants","project_settings","ngRoute"]);b.config(["$routeProvider","TOKEN_AUTH","PROJECT_SETTINGS",function(b,c,d){var e=a.extend({},c,d.TOKEN_AUTH);b.when(e.LOGIN,{templateUrl:"templates/auth/login.html",controller:"LoginCtrl",anonymousOnly:!0}).when(e.LOGOUT,{templateUrl:"templates/auth/logout.html",controller:"LogoutCtrl"})}])}(window.angular);